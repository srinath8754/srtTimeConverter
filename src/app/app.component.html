<!-- Preview Modal (single, clean) -->
<div *ngIf="previewContent !== null" class="preview-modal">
  <div class="preview-modal-content">
    <div class="preview-modal-header">
      <span class="preview-modal-title" style="max-width: 40vw; flex: none;">Preview: {{ previewFileName }}</span>
      <button class="preview-modal-close" (click)="closePreview()" title="Close">&times;</button>
      <select [(ngModel)]="previewDownloadType">
        <option value="txt">.txt</option>
        <option value="srt">.srt</option>
      </select>
      <button (click)="downloadPreview()" title="Download">Download</button>
      <button (click)="findNextError()" title="Find next error in table">Find Error</button>
    </div>
    <div class="preview-modal-body">
      <div style="width:100%; overflow-x:auto;">
        <table class="table table-bordered" style="min-width:700px; table-layout:fixed; background:#fff;">
          <thead>
            <tr>
              <th class="col-num">#</th>
              <th class="col-start">Start Time</th>
              <th class="col-end">End Time</th>
              <th class="col-text">Subtitle Text</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let subtitle of subtitles; let i = index">
              <td class="col-num">{{ i + 1 }}</td>
              <!-- Start Time -->
              <td class="col-start">
                <input
                  type="text"
                  class="form-control"
                  [ngClass]="{'input-error': subtitle.warning && subtitle.warning.toLowerCase().includes('start') || subtitle.warning && subtitle.warning.toLowerCase().includes('overlap') }"
                  [(ngModel)]="subtitle.start"
                  (ngModelChange)="validateSubtitleRow(i)"
                  name="start{{i}}"
                />
              </td>
              <!-- End Time -->
              <td class="col-end">
                <input
                  type="text"
                  class="form-control"
                  [ngClass]="{'input-error': subtitle.warning && subtitle.warning.toLowerCase().includes('end') || subtitle.warning && subtitle.warning.toLowerCase().includes('overlap') }"
                  [(ngModel)]="subtitle.end"
                  (ngModelChange)="validateSubtitleRow(i)"
                  name="end{{i}}"
                />
              </td>
              <!-- Subtitle Text + Warnings -->
              <td class="col-text">
                <span style="display: block; background: #f8fafc; color: #222; font-family: inherit; font-size: 1em; width: 100%; padding: 4px 0; cursor: default; white-space: pre-line;">
                  {{ subtitle.text }}
                </span>
                <div *ngIf="subtitle.warning" class="text-warning mt-1">
                  ⚠️ {{ subtitle.warning }}
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<header class="main-header">
  <span class="main-header-title">SRT Timestamp Converter</span>
</header>

<div style="text-align:center; margin-top: 20px;">
  <h2 style="display:none;">SRT Timestamp Converter</h2>  
  <div 
    class="drop-zone" 
    (drop)="onDrop($event)" 
    (dragover)="onDragOver($event)" 
    (dragleave)="onDragLeave($event)"
    [class.dragover]="isDragOver"
    style="border: 2px dashed #007bff; border-radius: 4px; padding: 20px; cursor: pointer;"
  >
    <span>Drag & drop .txt files here or</span>
    <input type="file" (change)="onFileSelected($event)" multiple accept=".txt" style="display:inline-block; margin-left:8px;" />
  </div>
</div>

<div *ngIf="convertedFiles.length > 0" style="margin-top: 20px;">
  <h2>Converted Files</h2>
  <div style="text-align:right; margin-bottom: 10px;">
    <select [(ngModel)]="downloadType" style="padding: 4px 8px;">
      <option value="txt">.txt</option>
      <option value="srt">.srt</option>      
    </select>
    <span style="margin-left: 8px; font-size: 14px; color: #555;">Download as</span>
    <button (click)="downloadAll()" style="margin-left: 16px;">Download All</button>
  </div>
<ul>
  <li *ngFor="let file of convertedFiles">
    <span class="file-name">{{file.name}}</span>
    <span class="file-actions">
      <button 
        (click)="openPreview(file)"
        [ngStyle]="file.hasCriticalError ? {'background-color':'#d32f2f', 'color':'#fff'} : {}"
        [attr.aria-label]="file.hasCriticalError ? 'Preview (SRT errors detected)' : 'Preview'"
        [attr.title]="file.hasCriticalError ? 'SRT time errors detected in this file' : 'Preview file'"
      >Preview</button>
      <button (click)="downloadFile(file)">Download</button>
      <button (click)="deleteFile(file)">Delete</button>
    </span>
  </li>
</ul>
</div>

<footer class="footer-signature" style="text-align:right; margin-top: 20px;">
  Developed by <span>Srinath</span><br>
</footer>
<footer class="footer-signature footer-left">
  <span class="footer-owned">Owned by RJ Boopathi</span>
</footer>
